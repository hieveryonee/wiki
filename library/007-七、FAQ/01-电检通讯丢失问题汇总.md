# 电检通讯丢失问题汇总

<table>
    <tr>
      <th>问题标题</th>
  		<th>问题描述</th>
  		<th>原因分析</th>
  		<th>解决方案</th>
    </tr>
    <!--模块1--->
    <tr>
      <td rowspan="6">与模块失去通讯​</td>
  		<td rowspan="6">电检设备功能寻址10 82后，等待20秒，对0x1202（DHU）物理寻址3e 00，DHU未响应</td>
  		<td> 【电检脚本】电检设备功能寻址10 82后，等待时间过短，DHU下电后，未完成上电操作，或上电后UpdateService未启动、未建链时，DHU无法响应诊断指令（3e 00）。 </td>
  		<td> 修改电检脚本，调整物理寻址3e 00的时间：在功能寻址10 82后，至少等待20s，再物理寻址3e 00。此外，由于偶现DHU与BGM建链失败的问题，因此建议物理寻址3e 00时，添加retry机制，持续发送3e 00指令20s，直到DHU响应指令。 </td>  
    </tr>

    <tr>
      <td>【BGM】BGM切换USAGE MODE失败，导致DHU无法唤醒，因此DHU无法响应诊断指令。</td>
      <td>BGM解决切换USAGE MODE失败的问题 </td>
    </tr>

    <tr>
      <td>【电源管理】【GEELY-26525】【GEELY-26876】BGM切换USAGE MODE为ACTIVE时，DHU正处于下电过程中，此时DHU无法维持唤醒状态；此后当电检设备功能寻址10 82指令时，由于DHU已经下电，因此无法接收诊断指令（10 82），同时也无法接收到后续指令（3e 00）。 </td>
      <td> 1. 规范产线操作人员操作，接上电瓶后，立即扫码做电检，确保BGM切换USAGE MODE时，DHU维持唤醒状态，可以接收到诊断指令。<br>
           2. 修改电源管理相关代码：BGM切换USAGE MODE切换至ACTIVE状态时，即便DHU处于休眠状态，也予以响应，可以唤醒DHU，使其可以接收诊断指令。 </td>
    </tr>

    <tr>
      <td>【以太网协议栈】【GEELY-25870】DHU与BGM间的物理层链路协商存在问题，导致二者无法正常通讯，因此DHU无法响应诊断指令（10 82，3e 00）。 </td>
      <td> DHU端检测到物理链路SQI值异常后，对switch进行一次复位操作。<br> 2022-10-31 已修复。 </td>
    </tr>

    <tr>
      <td>【以太网协议栈】【GEELY-25900】DHU与BGM建链时间长（20s），因此无法接收到诊断指令（3e 00）；导致该问题的原因是DHU与BGM之间存在物理链路link down的情况。 </td>
      <td> DHU启动后就开始检测linkdown（此时检测的linkdown不生成DTC事件），如果发生linkdown则立即对switch进行复位。<br> 2022-11-04 已修复。 </td>
    </tr>

    <tr>
      <td>【系统异常】【GEELY-23447】DHU启动时，卡在开机动画，因此无法响应诊断指令 </td>
      <td> 4202版本已修复，春晓基地更换4202版本后，未复现该现象。<br> 如后续仍存在类似问题，烦请bosch同事分析异常现象原因。 </td>
    </tr>


    <!--模块2--->
    <tr>
      <td rowspan="3">进入编程会话失败</td>
      <td rowspan="3">电检设备对0x1202进行物理寻址10 02时，DHU未响应或回复否定响应</td>
      <td> 【SWDL】【VDDM】【GEELY-26546】车速不是有效信号，不满足DHU进入编程会话的条件，因此当电检设备对0x1202进行物理寻址10 02时，DHU回复否定响应。 </td>
      <td>1. 解决车速不是有效信号的问题。<br>
          2. 修改电检脚本，待DHU启动后，再进行功能寻址10 82，使所有ECU同时进入编程会话。 </td>  
    </tr>

    <tr>
      <td>【FHC】​【电检脚本】同“与模块失去通讯”的问题原因：电检设备功能寻址10 82后，等待时间过短，DHU下电后，未完成上电操作，或上电后UpdateService未启动、未建链时，DHU无法响应诊断指令（10 02）。</td>
      <td> 同“与模块失去通讯”的解决方案：修改电检脚本，调整物理寻址10 02的时间：在功能寻址10 82后，至少等待20s，再物理寻址10 02。此外，由于偶现DHU与BGM建链失败的问题，因此建议物理寻址10 02时，添加retry机制，持续发送10 02指令20s，直到DHU响应指令。</td>
    </tr>

    <tr>
      <td>【FHC】【以太网协议栈】【GEELY-25870】【GEELY-25900】同“与模块失去通讯”的问题原因：DHU与BGM建链存在异常，导致DHU无法响应诊断指令（10 02）。 </td>
      <td> 同“与模块失去通讯”的解决方案：修复DHU与BGM建链失败的问题。 </td>
    </tr>

    <!--模块2--->
    <tr>
      <td rowspan="3">进入会话失败</td>
      <td rowspan="3">电检设备对0x1202进行物理寻址10 03时，DHU未响应诊断指令</td>
      <td> ​【SWDL】【电检脚本】同“与模块失去通讯”的问题原因：SWDL工位，刷写结束后，电检设备功能寻址11 81执行复位操作，其后等待时间过短，DHU下电后，未完成上电操作，或上电后UpdateService未启动、未建链时，DHU无法响应诊断指令（10 03）。</td>
      <td>同“与模块失去通讯”的解决方案：修改电检脚本，调整物理寻址10 03的时间：在功能寻址11 81后，至少等待20s，再物理寻址10 03。此外，由于偶现DHU与BGM建链失败的问题，因此建议物理寻址10 03时，添加retry机制，持续发送10 03指令20s，直到DHU响应指令。 </td>  
    </tr>

    <tr>
      <td>​【SWDL】【系统异常】【GEELY-24371】电检设备功能寻址11 81后，DHU退出编程会话后，系统未正常启动，因此无法响应诊断指令。</td>
      <td> bosch已修复；如仍存在系统无法启动的问题，请bosch同事分析异常现象原因。</td>
    </tr>

    <tr>
      <td>【ECOS】【以太网协议栈】【GEELY-25870】【GEELY-25900】同“与模块失去通讯”的问题原因：DHU与BGM建链存在异常，导致DHU无法响应诊断指令（3e 00）。 </td>
      <td>同“与模块失去通讯”的解决方案：修复DHU与BGM建链失败的问题。</td>
    </tr>


    <!--模块2--->
    <tr>
      <td>1201进入扩展模式失败</td>
      <td>1201进入扩展模式失败</td>
      <td> ​GEELY-37024 DHU1201 车载信息娱乐主机进入扩展模式失败</td>
      <td>参见分析，和电源管理模块相关需求 </td>
    </tr>

</table>
